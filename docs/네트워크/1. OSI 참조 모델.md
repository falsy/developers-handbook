# Networks

Net + Work의 합성어로 많은 노드들이 링크로 연결되어 있는 어떠한 망(Net)에 무엇인가를 전달하는 것(Work)을 이야기 합니다.

## Reference

`하루 3분 네트워크 교실`(아미노 에이지 지음 / 김현주 옮김 / 영진닷컴)과 위키피디아를 참고하여 작성하였습니다.

## OSI 참조 모델

국제 표준화 기구인 ISO는 데이터 통신 규격과 프로토콜을 표준화하기 위해 OSI 참조 모델(Open Systems Interconnection Reference Model)을 선언했습니다. 하지만 OSI 모델이 제안되었을 당시, TCP/IP는 이미 인터넷 초창기부터 널리 사용되고 있었고, 그 실용성과 간단한 구조 덕분에 사실상 네트워크 통신의 표준으로 자리 잡았습니다.

그럼에도 불구하고 OSI 모델은 네트워크 통신 시스템을 이해하고 설명하는 데 매우 유용한 개념적 프레임워크로 널리 사용되고 있습니다.

> 일반적으로 네트워크 학습에서는 OSI 모델을 먼저 설명한 후 TCP/IP를 다루는 경우가 많습니다. 이 때문에 OSI 모델을 바탕으로 TCP/IP가 더 현대적이고 실용적으로 발전한 것으로 오해하는 경우가 있습니다.

> 그러나 TCP/IP가 OSI 모델보다 약 10년 먼저 정의되고 사용되었습니다. TCP/IP는 4계층으로 이루어진 간단하고 실용적인 프로토콜이지만, OSI 모델은 7계층으로 더 구조적이고 포괄적인 방식으로 네트워크 통신을 정의한 모델입니다. 결과적으로, 현대 네트워크에서 사실상 표준으로 사용되는 것은 TCP/IP이지만, 네트워크를 설명할 때는 OSI 모델이 더 자주 사용됩니다.

# OSI 7 계층

총 7개의 계층으로 구성되어 있으며 아주 단순하게 `A` PC에서 `B` PC로 데이터를 송수신한다고 했을 때, `A` PC의 7계층부터 시작해서 6 → 5 → 4 → 3 → 2 → 1 계층 순서로 각 계층에서 필요한 로직(예를 들면 암호화, 압축 등..)을 수행하고 데이터에 헤더를 추가하고 캡슐화하여 전달되며 1 계층에서 `B` PC의 1 계층으로 데이터가 전달되어 다시 1 → 2 → 3 → 4 → 5 → 6 → 7 계층으로 순서대로 각 계층의 로직을 수행하고 헤더를 제거하여 데이터를 복원합니다.

# 1 계층 - 물리 계층

물리 계층이라는 이름처럼, 케이블이 연결되어 있는 기기에 신호를 전달하는 역할의 계층입니다.
PC가 다른 장치로 데이터늘 보낼 때, 컴퓨터는 내부적으로 데이터를 이진수(0과 1)로 처리하는데, 이 데이터를 컴퓨터의 네트워크 인터페이스 카드(NIC)가 전기 신호, 광 신호, 무선 신호 등으로 변환합니다. 그리고 수신부의 NIC에서 다시 신호를 비트 데이터로 변환하여 이를 수신 장치가 해석할 수 있도록 합니다.

```
[PC][NIC] ──── 케이블(신호) ──── [NIC][PC]
```

# 2 계층 - 데이터 링크 계층

2계층은 1계층의 신호가 닿는 범위인 `세그먼트` 내에서의 데이터 통신을 생각하는 계층입니다.

## 세그먼트

```
  ┌──── [허브] ────┐                 [허브] ────────── [허브]
  │       │       │                   │                │
  │       │       │                   │                │
[NIC]   [NIC]    [NIC]              [NIC]            [NIC]
[PC]    [PC]     [PC]               [PC]             [PC]
```

위와 같이 허브에 의해 연결되어 있는 범위를 이야기하며,

```
[PC][NIC] ──── [NIC][라우터][NIC] ──── [NIC][라우터][NIC] ──── [NIC][PC]
```

위와 같이 포인트투 포인트 네트워크라면 컴퓨터와 라우터 그리고 라우터와 라우터 사이의 범위를 이야기 합니다.

### 라우터

복수의 컴퓨터가 동시에 데이터 통신을 할 수 있도록 하는 패킷 교환기로 수신처가 연결되어 있는 회선을 골라서 거기로 패킷을 송출하는 역할과 사용하려고 한 회선이 사용중이라면 일시적으로 저장했다가 회선이 비는 것을 기다리는 역할을 합니다.

## LAN, WAN

LAN(Local Area Network)는 지역적으로 좁은 범위에서 본인의 책임으로 구축하는 네트워크로 예를 들면, A호실의 LAN, B호실의 LAN 이 호실을 합친 C건물 LAN,.. 이런식으로 일정한 범위 내에서 구축되는 네트워크 입니다.

그리고 이보다 넓은 범위의 네트워크로 멀리 떨어져 있는 지역의 LAN까지 통신사업자의 통신 케이블을 빌려서 연결한 네트워크가 WAN(Wide Area Network)로 이를 세계적인 큐모까지 확장한 것이 인터넷입니다.

## 데이터 전송 방법

1. 유니캐스트  
   1대 1 통신 방식으로 한 장치가 특정한 다른 한 장치에 데이터를 전송하는 방식입니다.

2. 브로드캐스트  
   1대 다 통신 방식으로 한 장치가 네트워크 상의 모든 장치에 데이터를 전송하는 방식입니다.

3. 멀티캐스트  
   1대 다수의 통신 방식으로 특정 그룹의 장치에게만 데이터를 전송하는 방식입니다.

4. 애니캐스트  
   1대 1 통신의 한 종류지만, 여러 대상중 가장 가까운 또는 가장 적합한 장치에 데이터를 전송하는 방식입니다. (예 CDN)

## MAC 주소

MAC 주소(Media Access Control Address)는 네트워크 상에서 장치를 식별하기 위해 사용되는 고유한 하드웨어 주소입니다. 네트워크 인터페이스 카드(NIC)에 할당된 식별자로 로컬 네트워크 내에서 데이터를 전송할 때, IP 주소 대신 MAC 주소를 이용하여 장치를 식별하고 통신합니다.

## 이더넷 프레임

LAN에서 널리 사용되는 이더넷은 데이터를 캡슐화하여 `프레임`이라는 PDU(Protocol Data Unit)로 전송합니다. 이더넷 프레임은 `헤더`에 수신처 MAC 주소, 송신처 MAC 주소, 그리고 타입 필드를 포함하며, `페이로드`에는 실제 데이터가 들어갑니다. 마지막으로, `트레일러`에는 오류 검출을 위한 `FCS(Frame Check Sequence)` 필드가 포함되어 있습니다.

## 프레이밍

예를 들어, 이더넷 프레임이 1계층인 물리 계층으로 전달될 때, 수신 측에서 신호를 올바르게 해석할 수 있도록 프레임의 시작을 알려야 합니다. 이를 위해 `프리앰블(Preamble)`과 `SFD(Start Frame Delimiter)`를 사용하여 프레임이 시작된다는 신호를 보냅니다.

`프리앰블`은 7바이트(56비트)의 동기화 패턴으로, 수신 측이 신호에 동기화할 수 있게 돕습니다. 그 뒤에 `SFD(1바이트, 8비트)`가 따라오며, 프레임이 곧 시작됨을 명확히 알려줍니다. 이러한 과정을 `프레이밍`이라고 하며, 이를 통해 송수신되는 신호가 데이터로 인식될 수 있습니다.

## 3 계층 - 네트워크 계층

2 계층이 `세그먼트` 내에서의 데이터 송수신을 이야기한다면, 3 계층은 `세그먼트` 간의 데이터 송수신에 대해 이야기하며 3 계층에서는 떨어져 있는 위치에 있는 다른 네트워크 내의 기기와의 통신을 수행합니다.

```
[PC] ────── [허브] ────── [라우터] ─────── [라우터] ──────── ...  ─── [PC]
    < 2계층 >     < 2계층 >       < 2계층 >        < 2계층 >
```

```
[PC] ─── [허브] ─── [라우터] ─── [라우터] ─── ...  ─── [PC]
    <------------------- 3 계층 ------------------->
```

## IP (Internet Protocol)

2 계층에서는 MAC 주소를 사용하여 데이터를 송수신하지만, 3 계층에서는 넓은 범위에서 많은 컴퓨터들 사이에서의 통신이기 때문에 MAC 주소(물리 주소)가 아닌 논리 주소를 사용합니다. 그리고 표준으로 사용되는 TCP/IP 프로토콜군에서는 이 논리 주소로 `IP(Internet Protocol)`를 사용합니다.

데이터에 IP의 헤더가 추가된 3계층의 PDU를 `IP 데이터그램` 이라고 부르며, IP 버전, 헤더 길이, 서비스 타입, 데이터 길이, ID, 플래그, 플래그먼트 오프셋, TTL, 프로토콜, 헤더 체크섬, 송신처 IP 주소, 수신처 IP 주소, 옵션을 포함하고 있습니다.

## DHCP (Dynamic Host Configuration Protocol)

이더넷을 사용해서 `IP 데이터그램`을 송수신하기 위해서는 4개의 주소가 필요합니다. 수신처 MAC 주소, 송신처 MAC 주소, 수신처 IP 주소, 송신처 IP 주소. 우선 송신처의 MAC 주소는 송신할 인터페이스의 MAC 주소를 사용하고 송신처의 IP 주소를 결정해야 하는데, 이때 수동으로 네트워크 관리자가 정한 IP 주소를 사용하는 정적인 방법과 IP 주소가 자동으로 설정되는 DHCP 라고 하는 프로토콜을 사용하는 동적인 방법이 있습니다.

DHCP는 할당할 IP 주소를 관리하고 할당하는 작업을 수행하는 DHCP 서버와 할당 받는 DHCP 클라이언트로 이루어져있습니다. 그리고 일반적으로 네트워크 관리자는 사전에 IP의 대여 기간을 설정하여 할당된 IP에 문제가 생겼을 때 초기화될 수 있도록 합니다.

## DNS (Domain Name System)

일반적으로 숫자로 이루어진 IP 주소는 기억하기 어렵기 때문에 문자열 형태의 도메인 네임을 사용합니다. 그리고 도메인 네임 역시 다른 컴퓨터와의 구별을 위한 값이기 때문에 고유한 값으로 사용됩니다.  
하지만 데이터 통신을 위해서는 IP 주소가 필요하기 때문에 도메인 이름과 IP주소를 대응하는 데이터베이스를 가지고 있는 DNS 서버에 문의하여 수신처의 IP 주소를 알 수 있습니다.

3 계층에서 이야기 하고 있지만 DNS 프로토콜은 7 계층인 애플리케이션 계층에 해당하는 프로토콜로 정확하게는 7 계층에서 DNS 프로토콜을 통해 도메인 네임을 가지고 IP 주소를 파악하고 이를 계층에 따라 전달하여 3 계층에서 사용되는 것입니다.

## ARP (Address Resolution protocol)

마지막으로 수신처의 MAC 주소를 알기 위한 방법으로 DNS를 통해 알게된 IP 주소의 컴퓨터에게 MAC 주소를 요청하는 `주소 해결 프로토콜`이 사용됩니다. 먼저 자신의 `ARP 테이블`에서 IP 주소에 대응되는 MAC 주소를 확인한 후 있다면 응답해주며, 없다면 ARP 요청을 브로드캐스트 합니다. 그리고 ARP 응답이 오면 이 값을 응답해주고, `ARP 테이블`에 결과를 추가합니다.

그리고 `ARP 테이블`에 기재된 IP 주소와 MAC 주소의 대응값은 일반적으로 300초 정도 유지하며 이후 사라지도록 설정합니다. 이유는 만약 인터페이스에 문제가 생겨서 MAC 주소가 변경될 경우 ARP의 요청에 지속적으로 잘못된 값을 응답하게 되기 때문입니다.

# 4 계층 - 전송 계층

4 계층 이상의 상위 계층에서는 전달할, 전달된 데이터에 대해 필요한 처리를 합니다. 예를 들면 3 계층까지는 수신처가 없거나 데이터가 도중에 발생하는 문제에 대해 신경쓰지 않고 파기합니다. 하지만 4계층에서는 데이터가 정상적으로 전달되지 않았을때 다시 데이터를 보내는 것과 같은 에러 복구 처리를 하거나 실질적으로 데이터를 주고 받는 애플리케이션을 `포트 번호`에 따라 식별하는 역할을 합니다.

위와 같이 통신에 필요한 처리를 실제로 제어하는 TCP(Transmission Control Protocol)과 UDP(User Datagram Protocol)라는 두개의 프로토콜이 있습니다. 그리고 이 둘은 상반되는 특징을 가지고 있기 때문에, 더 많은 기능 기능을 제공하는 TCP에 대해 알고 UDP는 그 특징의 반대로 생각할 수 있습니다.

## TCP

TCP는 일반적으로 많이 사용되는 프로토콜입니다. 특징은 UDP에 비해 느리지만, 커넥션을 통해서 높은 신뢰성을 보장하고 패킷 교환 방식을 사용하며, 데이터의 흐름제어 및 혼잡제어를 지원합니다.

## 연결 (Connection)

TCP는 데이터를 보내기 전에 수신처와의 연결을 먼저 수행하여 통신로를 확보합니다. 이때 TCP는 연결에 `3 Way Handshake`를 연결 종료에는 `4 Way Handshake`를 수행합니다.

이때 TCP의 헤더의 값을 가지고 진행을 하게 됩니다. TCP의 헤더에는 다양한 값이 있지만 그중에 6비트의 플래그 부분이 있으며 이곳에는 각각 1비트로 URG, `ACK`, PSH, PST, `SYN`, `FIN` 가 있으며 보통은 0을 가지고 있습니다. 여기서 `ACK`는 상태 통신 응답을 나타내며, `SYN`은 상대에 대한 접속 요청을, `FIN`은 접속 종료를 나타냅니다.

## 3 Way Handshake

클라이언트와 서버가 있다고 가정하고 이 둘이 연결을 하는 과정은 아래와 같습니다.

```
Client  ---------- 'SYN = 1' ------------>  Server
```

클라이언트는 플래그의 `SYN` 값을 1로 패킷을 보내며 접속을 요청합니다.

```
Client  <------- 'ACK = 1, SYN = 1' ------  Server
```

서버는 플래그에 `ACK` 값을 1로 통신 요청에 응답하며, `SYN` 값을 1로 패킷을 보내며 접속을 요청합니다.

```
Client  ---------- 'ACK = 1' ------------>  Server
```

마지막으로 클라이언트도 서버에게 `ACK` 플래그 값을 1로 요청에 응답하며 연결이 성립됩니다. 위와 같이 연결을 위한 3번의 패킷 교환을 3 Way Handshake 라고 합니다.

## 4 Way Handshake

클라이언트와 서버가 연결을 종료할때는 아래와 같은 과정을 거칩니다.

```
Client  ------- 'FIN = 1, ACK = 1' ------>  Server
```

클라이언트는 플래그의 `FIN` 값을 1로 연결 종료를 요청을 보냅니다.

```
Client  <----------- 'ACK = 1' -----------  Server
```

서버는 클라이언트의 요청을 확인하는 `ACK` 패킷을 보냅니다. 하지만 서버는 아직 자신이 보낼 데이터가 남아 있을 수 있으니 바로 연결을 종료하지는 않습니다.

```
Client  <------- 'FIN = 1, SYN = 1' ------  Server
```

서버도 클라이언트와 마찬가지로 모든 데이터를 전송하고 나면 `FIN` 패킷을 클라이언트에 보내며 종료를 요청합니다.

```
Client  ---------- 'ACK = 1' ------------>  Server
```

클라이언트는 서버로부터 `FIN` 패킷을 받으면 서버로 `ACK` 패킷을 서버로 다시 보냅니다.  
이로써 양쪽 모두의 연결이 졸료됩니다. 이렇게 4번의 패킷 교환으로 안전하게 연결을 종료하는 방법이 `4 Way Handshake` 입니다.

## 세그먼트 분할

TCP는 애플리케이션으로부터 받은 데이터를 `세그먼트`로 캡슐화 합니다. 이때 한 개의 데이터를 `MSS(Max Segment Size)`로 분할하는데 이렇게 한 개의 데이터가 여러개의 세그먼트로 나누어지며 각각 세그먼트에 번호를 부여하는데 이 번호를 `시퀀스 번호` 라고 합니다.

`시퀀스 번호`도 앞서 이야기한 `플래그` 처럼 TCP의 헤더에 포함합니다.

## 흐름 제어

TCP에서 클라이언트가 서버로 데이터를 보낼 때, 데이터는 `세그먼트`로 캡슐화되고, TCP 헤더에는 `시퀀스 번호`가 포함됩니다. 클라이언트는 이 세그먼트를 서버로 전송하고, 서버가 세그먼트를 수신하면 해당 세그먼트를 성공적으로 받았다는 `확인 응답(ACK)`을 클라이언트에 보냅니다. 이때, 서버는 `다음에 받을 시퀀스 번호`를 포함하여 응답합니다.

만약 에러가 발생해 데이터가 상대방에게 도달하지 않거나, `확인 응답(ACK)`이 도착하지 않으면, 클라이언트는 일정 시간이 지나도 응답이 없을 경우 해당 세그먼트를 `재전송`하여 에러를 복구합니다.

이 `대기 시간`을 결정하는 값이 `RTT(Round Trip Time)`입니다. RTT는 데이터를 송신한 후, `확인 응답이 돌아오는 데 걸린 시간`을 기준으로 설정되며, 초기값은 고정된 시간으로 설정되지만, 이후 `네트워크 상태에 따라 동적으로 변경`됩니다.

TCP에서는 세그먼트를 하나씩 전송하는 것은 비효율적이기 때문에, 수신자는 자신이 `한 번에 수신할 수 있는 버퍼 크기(윈도우 크기)`를 송신자에게 알려줍니다. 송신자는 이 윈도우 크기에 따라 `복수 개의 세그먼트를 한 번에 전송`할 수 있습니다. 이러한 방식으로 `송신자와 수신자 간의 데이터 전송 속도를 조절`하는 것이 `윈도우 제어`이며, 이를 통해 `데이터 흐름을 효율적으로 관리`합니다.

## 혼잡 제어

TCP에서 네트워크가 혼잡해질 경우, 데이터가 손실되거나 지연이 발생할 수 있습니다. 이러한 상황을 방지하기 위해 TCP는 `혼잡 제어`라는 메커니즘을 사용하여 송신자의 데이터 전송 속도를 조절합니다. 혼잡 제어는 네트워크 상에서 `혼잡을 감지`하고, 이를 기반으로 송신 속도를 동적으로 조정하는 과정입니다.

혼잡 제어는 주로 `혼잡 윈도우(Congestion Window, cwnd)`라는 개념을 통해 이루어집니다. 송신자는 처음에는 작은 혼잡 윈도우를 설정하고, 네트워크 혼잡이 없는 한 데이터를 점진적으로 더 많이 전송합니다. 이 과정은 `Slow Start(느린 시작)`라고 하며, 송신자는 `혼잡 윈도우 크기`를 지수적으로 증가시킵니다.

네트워크에서 `혼잡`이 발생했다고 감지되면(예: 패킷 손실), 송신자는 혼잡 윈도우 크기를 줄여 데이터 전송량을 감소시킵니다. 이를 `혼잡 회피(Congestion Avoidance)`라고 하며, 송신자는 혼잡이 해소될 때까지 전송 속도를 서서히 증가시킵니다. 패킷 손실이나 네트워크 상태에 따라 `Fast Retransmit(빠른 재전송)`과 `Fast Recovery(빠른 복구)` 같은 메커니즘을 사용해 데이터를 신속히 재전송하고 혼잡 윈도우를 조정합니다.

혼잡 제어의 핵심은 네트워크 상태를 모니터링하면서 송신자의 `데이터 전송 속도를 적절하게 조절`하여 네트워크 혼잡을 피하고, 효율적인 데이터 전송을 유지하는 데 있습니다. 혼잡 제어를 통해 TCP는 네트워크가 혼잡해질 때 데이터를 덜 전송하고, 혼잡이 해소되면 다시 전송 속도를 증가시킵니다.

## 포트 번호

포트 번호 역시 TCP의 헤더에 송신처의 포트 번호와 수신처의 포트 번호가 포함되어 있습니다. IP 주소가 네트워크 상에서 특정 장치르 식별하는데 사용된다면 포트번호는 그 장치 내에서 특정 서비스나 애플리케이션을 식별하는데 사용됩니다.

잘 알려진 포트번호로 0 ~ 1023 까지의 표준화된 특정 서비스에 할당됩니다. 예를 들어 80번 포트는 HTTP(웹 서비스) 443번 포트는 HTTPS(보안 웹 서비스) 22번 포트 (SSH) 보안 쉘 25번 포트 SMTP(이메일) 등이 있습니다.

## UDP

TCP는 커넥션(연결)이나 흐름제어 등 확실하게 데이터를 송신하는 프로토콜이지만, 반면 그 과정에서 확인 응답을 기다리는 시간이 길기 때문에 TCP의 전송 호율을 저하될 수 밖에 없습니다. 반면 UDP는 위와 같은 기능들을 제공하지 않지만(데이터 송신을 보장하지 않음) 빠르게 데이터를 전송할 수 있는 프로토콜입니다.

# 5 계층 - 세션 계층

5 계층 셰션 계층은 통신 세션을 설정, 유지, 종료하는 역할을 담당하며 동기화와 대화 제어를 통해 통신을 효율적으로 관리합니다.

쉬운 예시로 두사람의 전화 통화 상황과 비슷합니다.

- 세션 설정: 두 사람이 서로 전화를 걸고 받는 순간, 통화가 시작되면서 세션이 설정됩니다.
- 세션 유지: 두 사람은 통화가 진행되는 동안 대화를 계속 이어가며, 네트워크가 끊기지 않도록 관리됩니다.
- 세션 종료: 통화가 끝나면 두 사람이 전화를 끊으며 세션을 종료합니다.
- 동기화: 만약 통화 도중 잠깐 끊겼다가 다시 연결된다면, 그 전에 했던 대화부터 이어서 할 수 있도록 체크포인트가 설정된 것과 비슷합니다.

## 대화 제어

세션 계층은 통신하는 두 장치 간의 통신 방식을 조절합니다. 예를 들어, 반이중(half-duplex) 또는 전이중(full-duplex) 통신 방식을 결정합니다.

- 반이중: 한 번에 한쪽만 데이터를 전송할 수 있음 (예: 무전기)
- 전이중: 동시에 양쪽이 데이터를 주고받을 수 있음 (예: 전화 통화)

# 6 계층 - 표현 계층

6 계층 표현 계층은 `데이터의 형식 변환`을 담당하며, 송신 측에서 데이터가 네트워크를 통해 전송될 수 있도록 `표준화된 형식`으로 변환하고, 수신 측에서는 데이터를 `수신 장치의 하드웨어나 운영체제(OS)에 맞는 형식`으로 다시 변환하는 역할을 합니다.

예를 들어, `텍스트 데이터`가 아스키(ASCII) 형식을 사용하는 장치에서 엡시딕(EBCDIC) 형식을 사용하는 장치로 전송될 때, 표현 계층은 두 형식 간의 변환을 처리하여 `서로 다른 형식의 데이터가 호환`되도록 합니다.

또한, 표현 계층은 `데이터 압축` 및 `암호화`를 처리하여 전송 속도를 최적화하거나, 보안을 강화하는 기능도 담당합니다. 이러한 변환 덕분에, 하드웨어나 운영체제의 차이와 무관하게 데이터가 올바르게 전송될 수 있습니다.

# 7 계층 - 애플리케이션 계층

7 계층 애플리케이션 계층은 사용자와 네트워크 간의 상호작용을 담당하는 계층입니다. 이 계층은 사용자가 직접적으로 상호작용하는 애플리케이션과 연결되며, 네트워크 서비스를 제공하는 다양한 프로토콜과 애플리케이션이 포함됩니다.

애플리케이션 계층의 주요 역할은 사용자가 요청한 데이터 접근, 전송, 그리고 관리를 담당하는 애플리케이션을 통해 네트워크 자원을 제공하는 것입니다. 웹 브라우징, 이메일, 파일 전송과 같은 서비스를 제공하는 애플리케이션들이 이 계층에 해당됩니다.

간단한 예시로 사용자가 웹 브라우저를 통해 `www.example.com`을 입력하면, 애플리케이션 계층의 HTTP 프로토콜이 서버에 요청을 보내고, 서버로부터 웹 페이지 데이터를 받아 사용자에게 표시합니다.
